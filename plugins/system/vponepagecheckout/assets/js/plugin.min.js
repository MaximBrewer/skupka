/**
 *---------------------------------------------------------------------------------------
 * @package      VP One Page Checkout - Joomla! System Plugin
 * @subpackage   For VirtueMart 3+
 *---------------------------------------------------------------------------------------
 * @copyright    Copyright (C) 2012-2017 VirtuePlanet Services LLP. All rights reserved.
 * @license      GNU General Public License version 2 or later; see LICENSE.txt
 * @authors      Abhishek Das
 * @email        info@virtueplanet.com
 * @link         https://www.virtueplanet.com
 *---------------------------------------------------------------------------------------
 * $Revision: 4 $
 * $LastChangedDate: 2017-09-20 20:02:29 +0530 (Wed, 20 Sep 2017) $
 * $Id: plugin.min.js 4 2017-09-20 14:32:29Z Abhshek Das $
 * --------------------------------------------------------------------------------------
 */
VPOPC=window.VPOPC||{},ProOPC=window.ProOPC||{},ProOPC.jQuery=jQuery.noConflict(),function(a,d,p){ProOPC.ajaxPool={},ProOPC.cache={},VPOPC.options={},VPOPC.loadOptions=function(c){if(!c){for(var u,_,h,m=document.querySelectorAll('.vpopc-script-options.new'),f=0,g=m.length;f<g;f++)_=m[f],u=_.text||_.textContent,h=JSON.parse(u),h?VPOPC.loadOptions(h):null,_.className=_.className.replace(' new',' loaded');return}if(a.isEmptyObject(VPOPC.options))for(var v in c)this.options[v]=c[v];else for(var v in c)c.hasOwnProperty(v)&&(this.options[v]=c[v]);return this},VPOPC.setOption=function(c,m){this.options[c]=m},VPOPC._=function(c,m){return a.isEmptyObject(VPOPC.options)&&VPOPC.loadOptions(),m='undefined'==typeof m||'undefined'==typeof m?!1:m,'undefined'!=typeof this.options[c.toUpperCase()]&&typeof this.options[c.toUpperCase()]!='undefined'?this.options[c.toUpperCase()]:m},VPOPC.JText={strings:{},_:function(c,m){return a.isEmptyObject(this.strings)&&VPOPC.JText.load(),m='undefined'==typeof m||'undefined'==typeof m?null:m,'undefined'!=typeof this.strings[c.toUpperCase()]&&typeof this.strings[c.toUpperCase()]!='undefined'?this.strings[c.toUpperCase()]:m},sprintf:function(c,m){a.isEmptyObject(this.strings)&&VPOPC.JText.load(),m=typeof m==typeof void 0||'undefined'==typeof m?null:m;var u='undefined'!=typeof this.strings[c.toUpperCase()]&&typeof this.strings[c.toUpperCase()]!=typeof void 0?this.strings[c.toUpperCase()]:'';return u.replace('%s',m)},load:function(c){if(!c){for(var u,_,h,m=document.querySelectorAll('.vpopc-script-strings.new'),f=0,g=m.length;f<g;f++)_=m[f],u=_.text||_.textContent,h=JSON.parse(u),h?VPOPC.JText.load(h):null,_.className=_.className.replace(' new',' loaded');return}if(a.isEmptyObject(this.strings))for(var v in c)this.strings[v.toUpperCase()]=c[v];else for(var v in c)c.hasOwnProperty(v)&&(this.strings[v.toUpperCase()]=c[v]);return this}},ProOPC.init=function(c){if(c=ProOPC.hasValue(c),c&&navigator.userAgent.match(/IEMobile\/10\.0/)){var m=document.createElement('style');m.appendChild(document.createTextNode('@-ms-viewport{width:auto!important}')),document.getElementsByTagName('head')[0].appendChild(m)}a('#ProOPC .proopc-btn').each(function(){var b=a(this).attr('onclick'),C=a(this).attr('id'),C=C?a.trim(C):'',T=a(this).data('proopcReady');b&&0<=b.indexOf('ProOPC.')&&!T&&(a(this).click(function(P){return(P.preventDefault(),0<=b.indexOf('updateproductqty'))?ProOPC.updateproductqty(this):0<=b.indexOf('deleteproduct')?ProOPC.deleteproduct(this):0<=b.indexOf('guestcheckout')?ProOPC.guestcheckout(this):0<=b.indexOf('registerCheckout')?ProOPC.registerCheckout(this):0<=b.indexOf('loginAjax')?ProOPC.loginAjax(this):0<=b.indexOf('submitOrder')?ProOPC.submitOrder(this):0<=b.indexOf('savecoupon')?ProOPC.savecoupon(this):void 0}).data('proopcReady',!0).removeAttr('onclick'),(c||0>b.indexOf('submitOrder'))&&a(this).removeAttr('disabled'),T=a(this).data('proopcReady')),'proopc-task-guestcheckout'!=C||T?'proopc-task-registercheckout'!=C||T?'proopc-task-loginajax'!=C||T?'proopc-order-submit'!=C||T?'proopc-task-savecoupon'!=C||T?a(this).hasClass('proopc-task-updateqty')&&!T?a(this).click(function(P){return P.preventDefault(),ProOPC.updateproductqty(this)}).data('proopcReady',!0).removeAttr('disabled'):a(this).hasClass('proopc-task-deleteproduct')&&!T&&a(this).click(function(P){return P.preventDefault(),ProOPC.deleteproduct(this)}).data('proopcReady',!0).removeAttr('disabled'):a(this).click(function(P){return P.preventDefault(),ProOPC.savecoupon(this)}).data('proopcReady',!0).removeAttr('disabled'):(a(this).click(function(P){return P.preventDefault(),ProOPC.submitOrder(this)}).data('proopcReady',!0),c&&a(this).removeAttr('disabled')):a(this).click(function(P){return P.preventDefault(),ProOPC.loginAjax(this)}).data('proopcReady',!0).removeAttr('disabled'):a(this).click(function(P){return P.preventDefault(),ProOPC.registerCheckout(this)}).data('proopcReady',!0).removeAttr('disabled'):a(this).click(function(P){return P.preventDefault(),ProOPC.guestcheckout(this)}).data('proopcReady',!0).removeAttr('disabled')});var g,v,u=a('form#EditBTAddres'),_=a('form#EditSTAddres'),h=a('form#proopc-shipment-form'),f=a('form#proopc-payment-form');a('select#virtuemart_state_id',u).attr('id','virtuemart_state_id_field'),a('select#shipto_virtuemart_state_id',_).attr('id','shipto_virtuemart_state_id_field'),a('#city_field, #zip_field, #virtuemart_country_id_field, #virtuemart_state_id_field',u).each(function(){a(this).data('proopcReady')||a(this).change(function(){ProOPC.updateBTaddress(this)}).data('proopcReady',!0),g=a(this).attr('onchange'),g&&0<=g.indexOf('ProOPC')&&a(this).removeAttr('onchange')}),a('#shipto_city_field, #shipto_zip_field, #shipto_virtuemart_country_id_field, #shipto_virtuemart_state_id_field',_).each(function(){a(this).data('proopcReady')||a(this).change(function(){ProOPC.updateSTaddress(this)}).data('proopcReady',!0),g=a(this).attr('onchange'),g&&0<=g.indexOf('ProOPC')&&a(this).removeAttr('onchange')}),a('select#virtuemart_state_id_field, select#shipto_virtuemart_state_id_field').each(function(){(a(this).hasClass('required')||a(this).attr('required'))&&!1!==a(this).data('frequired')?a(this).data('frequired',!0):!0!==a(this).data('frequired')&&a(this).data('frequired',!1)}),a('select#proopc-select-st',_).each(function(){a(this).data('proopcReady')||a(this).change(function(){ProOPC.selectSTAddress(this)}).data('proopcReady',!0),g=a(this).attr('onchange'),g&&0<=g.indexOf('ProOPC')&&a(this).removeAttr('onchange')}),a('input[name="virtuemart_shipmentmethod_id"][type="radio"]',h).each(function(){a(this).data('proopcReady')||a(this).click(function(){return ProOPC.setshipment(this)}).data('proopcReady',!0),v=a(this).attr('onclick'),v&&0<=v.indexOf('ProOPC')&&a(this).removeAttr('onclick')}),a('input[name="virtuemart_paymentmethod_id"][type="radio"]',f).each(function(){a(this).data('proopcReady')||a(this).click(function(){return ProOPC.setpayment(this)}).data('proopcReady',!0),v=a(this).attr('onclick'),v&&0<=v.indexOf('ProOPC')&&a(this).removeAttr('onclick')}),a('select',h).each(function(){var b=a(this).closest('fieldset');b.length&&a(this).width(b.width()),a(this).data('proopcReady')||a(this).change(function(){var C=a('form#proopc-shipment-form').find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked');C.length&&ProOPC.setshipment(C)}).data('proopcReady',!0)}),a('select',f).each(function(){a(this).data('proopcReady')||a(this).change(function(){var b=a('form#proopc-payment-form').find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),C=b.data('pmtype');b.length&&C&&0<=a.inArray(C,['sisowideal','buckaroo','piraeus'])&&ProOPC.setpayment(b)}).data('proopcReady',!0)});var y=a('input[name="proopc-method"][type="radio"]');y.length&&!y.data('proopcReady')&&y.change(function(){ProOPC.opcmethod()}).removeAttr('onchange').data('proopcReady',!0);var E=VPOPC._('BT_UPDATE_FIELDS'),S=VPOPC._('ST_UPDATE_FIELDS');E&&'array'===a.type(E)&&a.each(E,function(b,C){if(C){var T=a('[name="'+C+'"]',u);T.length&&!T.data('proopcReady')&&T.change(function(){ProOPC.updateBTaddress(this)}).data('proopcReady',!0)}}),S&&'array'===a.type(S)&&a.each(S,function(b,C){if(C){var T=a('[name="'+C+'"]',_);T.length&&!T.data('proopcReady')&&T.change(function(){ProOPC.updateSTaddress(this)}).data('proopcReady',!0)}}),a('input.datepicker-db:hidden').each(function(){if(!a(this).data('proopcDateReady')){var b=this,C=a(b).data('dateInterval');C&&clearInterval(C),C=setInterval(function(){a(b).val()!=a(b).data('oldValue')&&a(b).data('oldValue',a(b).val()).trigger('change')},200),a(b).data('dateInterval',C).data('proopcDateReady',!0)}})},ProOPC.initSpinner=function(){ProOPC.cache.spinner=ProOPC.cache.spinner||new VPSpinner({lines:13,length:3,width:2,radius:5,corners:1,rotate:0,direction:1,color:'#FFF',speed:1.5,trail:60,shadow:!1,hwaccel:!1,className:'proopc-spinner',zIndex:2e9,top:'auto',left:'auto'}).spin();var m={lines:10,length:10,width:4,radius:15,corners:1,rotate:0,direction:1,color:VPOPC._('SPINNER_COLOR'),speed:1.5,trail:60,shadow:!1,hwaccel:!0,className:'proopc-page-loader',zIndex:2e9,top:20,left:14};ProOPC.cache.loader=ProOPC.cache.loader||new VPSpinner(m).spin();var u={lines:10,length:5,width:3,radius:8,corners:1,rotate:0,direction:1,color:VPOPC._('SPINNER_COLOR'),speed:1.5,trail:40,shadow:!1,hwaccel:!0,className:'proopc-area-loader',zIndex:2e9,top:20,left:14};ProOPC.cache.area_loader=ProOPC.cache.area_loader||new VPSpinner(u).spin()},ProOPC.ajaxManager=function(){var c=[],m=!1,u=!1;return{tid:null,opt:{type:'POST',dataType:'JSON',url:null,cache:!1},setContinuous:function(_){m=!!_},isRunning:function(){return u},addReq:function(_,h){_.opcTask=h?h:null,c.push(_)},removeReq:function(_){-1<a.inArray(_,c)&&c.splice(a.inArray(_,c),1)},run:function(){var f,g,v,_=this,h=m?500:1e3;u=!0,c.length?(f=c[0].hasOwnProperty('complete')?c[0].complete:null,g=c[0].hasOwnProperty('error')?c[0].error:null,v=c[0].hasOwnProperty('opcTask')&&typeof c[0].opcTask!=typeof void 0&&c[0].opcTask?'ajaxManager task '+c[0].opcTask+'.':'ajaxManager.',c[0].url=c[0].hasOwnProperty('url')?c[0].url:VPOPC._('URI'),c[0]=a.extend(!0,{},_.opt,c[0]),c[0].complete=function(y,E){'function'==typeof f&&f.call(this,y,E),c.shift(),_.run.apply(_,[])},c[0].error=function(y,E,S){'function'==typeof g&&g.call(this,y,E,S),console.warn('Ajax error is generated running '+v),E&&'abort'!=E&&S&&'abort'!=S&&(console.log(y),'parsererror'==E&&y.responseText&&console.log(y.responseText),console.log(E),console.log(S))},a.ajax(c[0])):_.tid=setTimeout(function(){_.run.apply(_,[])},h)},stop:function(){c=[],this.tid&&clearTimeout(this.tid),u=!1}}}(),ProOPC.opcmethod=function(){var c=a('input[type="radio"][name="proopc-method"]:checked').val();'guest'==c?(a('.proopc-reg-form, .proopc-login-form').addClass('soft-hide').css('opacity',0),a('.proopc-reg-advantages, .proopc-guest-form').removeClass('soft-hide').css('opacity',0),setTimeout(function(){a('.proopc-reg-advantages, .proopc-guest-form').animate({opacity:1},500),ProOPC.inputwidth(),ProOPC.selectwidth()},50)):'login'==c?(a('.proopc-reg-form, .proopc-reg-advantages, .proopc-guest-form').addClass('soft-hide').css('opacity',0),a('.proopc-login-form').removeClass('soft-hide').css('opacity',0),setTimeout(function(){a('.proopc-login-form').animate({opacity:1},500),ProOPC.inputwidth(),ProOPC.selectwidth()},50)):(a('.proopc-reg-advantages, .proopc-guest-form, .proopc-login-form').addClass('soft-hide').css('opacity',0),a('.proopc-reg-form').removeClass('soft-hide').css('opacity',0),setTimeout(function(){a('.proopc-reg-form').animate({opacity:1},500,function(){a('#UserRegistration #dynamic_recaptcha_1').length&&ProOPC.setStyle()}),ProOPC.inputwidth(),ProOPC.selectwidth()},50))},ProOPC._updateFieldState=function(c,m,u){var _=a(this).siblings('.status');c?(a(this).removeClass('invalid').addClass('valid').removeClass('hasFieldTip').removeAttr('title'),_.removeClass('invalid').removeClass('validating'),ProOPC.hasValue(m)&&_.addClass('valid')):null===c?(a(this).removeClass('valid').removeClass('invalid'),_.removeClass('invalid').removeClass('valid').addClass('validating')):(a(this).removeClass('valid').addClass('invalid'),_.addClass('invalid').removeClass('valid').removeClass('validating')),ProOPC.hasValue(u)?_.attr('title',VPOPC.JText._(u)):_.removeAttr('title'),ProOPC.tooltip()},ProOPC.hasValue=function(c){return typeof c!=typeof void 0&&c&&'0'!=c&&c},ProOPC._checkAjaxPool=function(c){ProOPC.hasValue(c)&&ProOPC.ajaxPool.hasOwnProperty(c)&&4!=ProOPC.ajaxPool[c].readystate&&ProOPC.ajaxPool[c].abort()},ProOPC._triggerEvent=function(c){c=ProOPC.hasValue(c)&&'string'===a.type(c)?[c]:c,a(p).trigger('vpopc.event',c)},ProOPC._reload=function(){var c=a('form#proopc-reload-form');c.length?c.submit():ProOPC._reload()},ProOPC.ajax=function(c,m){c=ProOPC.hasValue(c)?c:'dummy';var u={type:'POST',dataType:'JSON',url:VPOPC._('URI'),data:'ctask='+c,cache:!1,async:!0,error:function(_,h,f){'abort'!=h&&'abort'!=f&&(console.warn('Ajax error is generated executing ctask '+c+'.'),'parsererror'==h&&_.responseText&&console.log(_.responseText),console.log(_),console.log(h),console.log(f)),typeof m.errorCallback!='undefined'&&'function'==a.type(m.errorCallback)&&m.errorCallback.call(this)}};return m=a.extend(!0,{},u,m),ProOPC._checkAjaxPool(c),ProOPC.ajaxPool[c]=a.ajax(m),ProOPC.ajaxPool[c]},ProOPC.bindFormValidator=function(){var c=a('form#UserLogin'),m=a('form#GuestUser'),u=a('form#UserRegistration'),_='change blur keyup';a('input[type="text"]:not(#proopc-secretkey), input[type="password"], input[type="email"]',c).on(_,function(){a(this).val()?ProOPC._updateFieldState.call(this,!0,!1):ProOPC._updateFieldState.call(this,!1,!1,'PLG_VPONEPAGECHECKOUT_REQUIRED_FIELD')}),a('input[type="text"], input[type="email"]',m).on(_,function(){if('email_field'!=a(this).attr('id'))return!1;var f=a(this).val();f&&f.length&&(f=a.trim(f),a(this).val(f)),ProOPC.validateEmail(f)?ProOPC._updateFieldState.call(this,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'):ProOPC._updateFieldState.call(this,!1,!0,'PLG_VPONEPAGECHECKOUT_EMAIL_INVALID')}),a('input[type="text"], input[type="email"], input[type="password"], input[type="checkbox"], select, textarea',u).on(_,function(){var f=this,g=a(this).closest('form'),v=a(this).parent('.proopc-input'),y=a(f).attr('required'),E=a(f).attr('id'),S=a(f).val();if(!a(f).hasClass('required')&&!ProOPC.hasValue(y)&&!v.data('required'))return!0;switch(a(f).attr('required',!0),E){case'email_field':S&&S.length&&(S=a.trim(S),a(f).val(S)),ProOPC.validateEmail.call(f,S)?(g.find('input#verify_email_field').trigger('change'),VPOPC._('AJAXVALIDATION')?((typeof ProOPC.cache.emails=='undefined'||'object'!==a.type(ProOPC.cache.emails))&&(ProOPC.cache.emails={}),ProOPC.cache.emails.hasOwnProperty(S)?ProOPC.cache.emails[S]?(ProOPC.removeFieldTip(f,!1),ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED')):(ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID'),a(f).addClass('hasFieldTip').attr('title',VPOPC.JText._('COM_USERS_PROFILE_EMAIL1_MESSAGE')),ProOPC.fieldTip(),ProOPC.showFieldTip(f)):ProOPC.ajax('checkemail',{beforeSend:function(){ProOPC._updateFieldState.call(f,null,!1,null)},data:'ctask=checkemail&email='+S,success:function(A){typeof A.valid=='undefined'||A.valid?(ProOPC.removeFieldTip(f,!1),ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'),ProOPC.cache.emails[S]=!0):(ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID'),a(f).addClass('hasFieldTip').attr('title',VPOPC.JText._('COM_USERS_PROFILE_EMAIL1_MESSAGE')),ProOPC.fieldTip(),ProOPC.showFieldTip(f),ProOPC.cache.emails[S]=!1)}})):ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED')):ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_EMAIL_INVALID');break;case'verify_email_field':S&&S.length&&(S=a.trim(S),a(f).val(S));var b=g.find('input#email_field').val();S==b&&S?ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'):ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID');break;case'username_field':ProOPC.validateUsername.call(f,S)?VPOPC._('AJAXVALIDATION')?((typeof ProOPC.cache.usernames=='undefined'||'object'!==a.type(ProOPC.cache.usernames))&&(ProOPC.cache.usernames={}),ProOPC.cache.usernames.hasOwnProperty(S)?ProOPC.cache.usernames[S]?(ProOPC.removeFieldTip(f,!1),ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED')):(ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID'),a(f).addClass('hasFieldTip').attr('title',VPOPC.JText._('COM_USERS_PROFILE_USERNAME_MESSAGE')),ProOPC.fieldTip(),ProOPC.showFieldTip(f)):ProOPC.ajax('checkusername',{beforeSend:function(){ProOPC._updateFieldState.call(f,null,!1,null)},data:'ctask=checkuser&username='+S,success:function(A){typeof A.valid=='undefined'||A.valid?(ProOPC.removeFieldTip(f,!1),ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'),ProOPC.cache.usernames[S]=!0):(ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID'),a(f).addClass('hasFieldTip').attr('title',VPOPC.JText._('COM_USERS_PROFILE_USERNAME_MESSAGE')),ProOPC.fieldTip(),ProOPC.showFieldTip(f),ProOPC.cache.usernames[S]=!1)}})):ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'):ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_USERNAME_INVALID');break;case'password_field':var C=g.find('input#password2_field'),T=g.find('#password-stregth'),P=g.find('#meter-status');C.removeClass('valid').siblings('.status').removeClass('valid'),ProOPC.removeFieldTip(f,!1),S&&ProOPC.validatePassword.call(f,S)?(ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'),ProOPC.checkStrength.call(f,S)):(a('#password-stregth, #meter-status',g).removeAttr('class').addClass('invalid'),ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID'),T.text(''));break;case'password2_field':var b=g.find('input#password_field').val();S==b&&S?ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'):ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID');break;case'name_field':default:S?ProOPC._updateFieldState.call(f,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED'):ProOPC._updateFieldState.call(f,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID');}})},ProOPC.validateForm=function(){return a(this).find('input, select, textarea').trigger('blur'),!a(this).find('.invalid').length||(ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_REQUIRED_FIELDS_MISSING')),!1)},ProOPC.validateEmail=function(c){if(VPOPC._('DISABLELIVEVALIDATION'))return!0;var m=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;return!m.test(c)||5>c.length?!1:!0},ProOPC.validateUsername=function(c){if(VPOPC._('DISABLELIVEVALIDATION'))return!0;var m=/^[a-zA-Z0-9]+$/;return!!m.test(c)},ProOPC.validatePassword=function(c){if(VPOPC._('DISABLELIVEVALIDATION'))return!0;var m=this,u=!1;if(ProOPC.removeFieldTip(m,!1),a(this).removeAttr('title').removeClass('hasFieldTip'),0<=c.indexOf(' '))a(m).addClass('hasFieldTip').attr('title',VPOPC.JText._('COM_USERS_MSG_SPACES_IN_PASSWORD')),r=!0;else if(VPOPC._('PASSWORD_INTEGERS')||VPOPC._('PASSWORD_SYMBOLS')||VPOPC._('PASSWORD_UPPERCASE')){var _=c.match(/\d/g),h=c.match(/\W/g),f=c.match(/[A-Z]/g);0<VPOPC._('PASSWORD_INTEGERS')&&(!_||_.length<VPOPC._('PASSWORD_INTEGERS'))?(1==VPOPC._('PASSWORD_INTEGERS')?a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N_1',VPOPC._('PASSWORD_INTEGERS'))):a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_NOT_ENOUGH_INTEGERS_N',VPOPC._('PASSWORD_INTEGERS'))),u=!0):0<VPOPC._('PASSWORD_SYMBOLS')&&(!h||h.length<VPOPC._('PASSWORD_SYMBOLS'))?(1==VPOPC._('PASSWORD_SYMBOLS')?a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N_1',VPOPC._('PASSWORD_SYMBOLS'))):a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_NOT_ENOUGH_SYMBOLS_N',VPOPC._('PASSWORD_SYMBOLS'))),u=!0):0<VPOPC._('PASSWORD_UPPERCASE')&&(!f||f.length<VPOPC._('PASSWORD_UPPERCASE'))&&(1==VPOPC._('PASSWORD_UPPERCASE')?a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N_1',VPOPC._('PASSWORD_UPPERCASE'))):a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_NOT_ENOUGH_UPPERCASE_LETTERS_N',VPOPC._('PASSWORD_UPPERCASE'))),u=!0)}else 0<VPOPC._('PASSWORD_LENGTH')&&c.length<VPOPC._('PASSWORD_LENGTH')&&(a(m).addClass('hasFieldTip').attr('title',VPOPC.JText.sprintf('COM_USERS_MSG_PASSWORD_TOO_SHORT_N',VPOPC._('PASSWORD_LENGTH'))),u=!0);return!u||(ProOPC.fieldTip(),ProOPC.showFieldTip(this),!1)},ProOPC.checkStrength=function(c){if(VPOPC._('DISABLELIVEVALIDATION'))return!0;var m=this,u=a(m).closest('form'),_=a('#password-stregth, #meter-status',u),h=u.find('#password-stregth'),f=u.find('#meter-status'),g=0;return 4>c.length?(_.removeAttr('class').addClass('short'),h.text(VPOPC.JText._('PLG_VPONEPAGECHECKOUT_TOO_SHORT')),ProOPC._updateFieldState.call(m,!1,!0,'PLG_VPONEPAGECHECKOUT_INVALID'),!1):void(4<c.length&&(g+=1),c.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(g+=1),c.match(/([a-zA-Z])/)&&c.match(/([0-9])/)&&(g+=1),c.match(/([!,%,&,@,#,$,^,*,?,_,~])/)&&(g+=1),c.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,",%,&,@,#,$,^,*,?,_,~])/)&&(g+=1),2>g?(_.removeAttr('class').addClass('weak'),h.text(VPOPC.JText._('PLG_VPONEPAGECHECKOUT_WEAK')),ProOPC._updateFieldState.call(m,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED')):2==g?(_.removeAttr('class').addClass('good'),h.text(VPOPC.JText._('PLG_VPONEPAGECHECKOUT_GOOD')),ProOPC._updateFieldState.call(m,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED')):(_.removeAttr('class').addClass('strong'),h.text(VPOPC.JText._('PLG_VPONEPAGECHECKOUT_STRONG')),ProOPC._updateFieldState.call(m,!0,!0,'PLG_VPONEPAGECHECKOUT_VALIDATED')))},ProOPC.guestcheckout=function(){var c=a('form#GuestUser'),m=a('button#proopc-task-guestcheckout',c),u=a('#proopc-guest-process',c);return ProOPC.ajax('guestcheckout',{dataType:'HTML',data:c.serialize(),beforeSend:function(){return!!ProOPC.validateForm.call(c)&&void(u.append(ProOPC.cache.spinner.el),m.attr('disabled',!0))},success:function(){u.find('.proopc-spinner').remove(),m.removeAttr('disabled'),ProOPC.setmsg('info',VPOPC.JText._('PLG_VPONEPAGECHECKOUT_EMAIL_SAVED'),!1),ProOPC.processCheckout({error:0}),ProOPC._triggerEvent(['guestcheckout.initiated'])},errorCallback:function(){u.find('.proopc-spinner').remove(),m.removeAttr('disabled'),ProOPC.setmsg('1','Some error occurred. Check console log for more details.')}}),!1},ProOPC.registerCheckout=function(){var c=a('form#UserRegistration'),m=a('button#proopc-task-registercheckout',c),u=a('#proopc-register-process',c);return ProOPC.ajax('register',{data:c.serialize()+'&ctask=register',beforeSend:function(){return!!ProOPC.validateForm.call(c)&&void(m.attr('disabled',!0),u.append(ProOPC.cache.spinner.el))},success:function(_){if(m.removeAttr('disabled'),u.find('.proopc-spinner').remove(),!('object'==a.type(_)&&_.msg))ProOPC._triggerEvent(['registration.success']),ProOPC._onRegistrationSuccess(),'1'==_||1==_?(ProOPC.setmsg(3,VPOPC.JText._('COM_VIRTUEMART_REG_COMPLETE')),VPOPC._('RELOAD')?ProOPC._reload():setTimeout(function(){ProOPC.processCheckout(_)},100)):'string'===a.type(_)&&-1==_.indexOf('</head>')?ProOPC.setmsg(3,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_REGISTRATION_NEED_LOGIN')):(ProOPC.setmsg(3,VPOPC.JText._('COM_VIRTUEMART_REG_COMPLETE')),VPOPC._('RELOAD')?ProOPC._reload():setTimeout(function(){ProOPC.processCheckout({error:0})},100));else if(1==_.error){if(ProOPC.setmsg('1',_.msg),_.reload)return ProOPC._reload(),!1;'undefined'!=typeof Recaptcha&&Recaptcha.reload(),ProOPC._triggerEvent(['registration.failed'])}else ProOPC.setmsg(3,_.msg),ProOPC._triggerEvent(['registration.success']),ProOPC._onRegistrationSuccess(),_.stop||(VPOPC._('RELOAD')?ProOPC._reload():setTimeout(function(){ProOPC.processCheckout(_)},100))},errorCallback:function(){m.removeAttr('disabled'),u.find('.proopc-spinner').remove(),ProOPC.setmsg(1,'Error submiting registration form. Check console log for more details.')}}),!1},ProOPC._onRegistrationSuccess=function(){var c=a('form#UserRegistration'),m=a('input[name="proopc-method"][value="login"]'),u=a('#password-stregth',c),_=a('#meter-status',c);c[0].reset(),c.find('i.status').removeClass('valid').removeClass('invalid'),u.removeAttr('class').text(''),_.removeAttr('class'),m.length&&m.prop('checked',!0).trigger('change')},ProOPC.disableSubmit=function(){a('button#proopc-order-submit').attr('disabled','disabled').trigger('disabled')},ProOPC.enableSubmit=function(){var c=a('button#proopc-order-submit');ProOPC.cache.submitTimeout&&c.attr('disabled')&&clearTimeout(ProOPC.cache.submitTimeout),ProOPC.cache.submitTimeout=setTimeout(function(){c.removeAttr('disabled').trigger('enabled')},1e3)},ProOPC.disableMethodSelection=function(){a('input[name="virtuemart_paymentmethod_id"][type="radio"], input[name="virtuemart_shipmentmethod_id"][type="radio"]').attr('disabled','disabled')},ProOPC.enableMethodSelection=function(){a('input[name="virtuemart_paymentmethod_id"][type="radio"], input[name="virtuemart_shipmentmethod_id"][type="radio"]').removeAttr('disabled')},ProOPC.addloader=function(c){a(c).each(function(){a(this).find('.proopc-loader-overlay').length||(a(this).append('<div class="proopc-loader-overlay"></div><div class="proopc-area-loader"><span></span></div>'),a('.proopc-area-loader > span').html(ProOPC.cache.area_loader.el))}),ProOPC.disableSubmit(),a('body').addClass('proopc-loading')},ProOPC.removeloader=function(c){a(c).each(function(){a('.proopc-loader-overlay, .proopc-area-loader',this).remove()}),ProOPC.enableSubmit(),a('body').removeClass('proopc-loading')},ProOPC.addPageLoader=function(c){if(!a('#proopc-page-overlay',p).length){var m=a('<div />',{id:'proopc-page-overlay'}),u=a('<span />').append(ProOPC.cache.loader.el),_=a('<div />',{id:'proopc-page-spinner'}).append(u);a('body').append(m).append(_),a('#proopc-page-overlay').css({display:'block',height:a('body').outerHeight()}).animate({opacity:0.7},300)}if(ProOPC.hasValue(c)){var h=a('#proopc-order-process');c=VPOPC.JText._(c,c),c&&(!h.length&&(h=a('<div />',{id:'proopc-order-process'}).appendTo('body')),h.text(c))}a('body').addClass('proopc-page-loading')},ProOPC.removePageLoader=function(){a('#proopc-page-overlay, #proopc-page-spinner, #proopc-order-process',p).remove(),a('body').removeClass('proopc-page-loading')},ProOPC.getToken=function(){return a('#formToken input:hidden').attr('name')+'=1'},ProOPC.pluginLoaded=function(c){return!!a.hasOwnProperty(c)||!!a.fn.hasOwnProperty(c)},ProOPC.setmsg=function(c,m,u){u='undefined'==typeof u||typeof u===void 0||u;var _=a('<button />',{type:'button','class':'close'}).attr('onclick','ProOPC.close(this);').html('&times;'),h=a('<span />').html(m),f=a('<div />',{'class':'proopc-alert'}).append(_).append(h),g='proopc-warning-msg';'1'==c||'error'==c?g='proopc-error-msg':'2'==c||'warning'==c?g='proopc-warning-msg':'3'==c||'success'==c?g='proopc-success-msg':('4'==c||'info'==c)&&(g='proopc-info-msg'),f.addClass(g),a('#proopc-system-message').html(f),u&&a('html,body').animate({scrollTop:a('#proopc-system-message').offset().top-VPOPC._('SYSTEM_MESSAGE_OFFSET',100)},500)},ProOPC.initStateField=function(){if(!ProOPC.pluginLoaded('vm2front'))return console.warn('jQuery.vm2front plugin not loaded. Please enable "Using the Script ajax Countries / Regions" option in VirtueMart Configuration.'),!1;var c=a('input#BTStateID').val(),m=a('input#STStateID').val(),u={dest:'#virtuemart_state_id_field',ids:c,prefiks:''};a('select#virtuemart_state_id_field').length&&a('select#virtuemart_country_id_field').vm2front('list',u),u.ids=m,u.prefiks='shipto_',a('select#shipto_virtuemart_state_id_field').length&&(u.dest='#shipto_virtuemart_state_id_field',a('select#shipto_virtuemart_country_id_field').vm2front('list',u))},ProOPC.processCheckout=function(c){if(ProOPC.hasValue(c)&&'object'===a.type(c)||(c={error:0,msg:[]}),c.error&&c.msg.length){var m='';return a.each(c.msg,function(u,_){m=m+'<div class="error-msg">'+_+'</div>'}),ProOPC.setmsg(1,m),!1}ProOPC.ajax('procheckout',{dataType:'HTML',data:'task=procheckout',beforeSend:function(){ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_PLEASE_WAIT'),a('.proopc-tooltip, .proopc-fieldtip').remove()},success:function(u){var _=a(u).find('div#ProOPC').html();_||(_=u),a('div#ProOPC').html(_),VPOPC._('RELOAD')||a('html, body').animate({scrollTop:a('#proopc-system-message').offset().top-100},500),ProOPC._triggerEvent(['checkout.finalstage'])},complete:function(){ProOPC.initStateField(),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.bindFormValidator(),ProOPC.productdetails(),ProOPC.enableSubmit(),ProOPC.defaultSP(),ProOPC.removePageLoader(),(typeof klarna!='undefined'||'undefined'!=typeof klarna)&&ProOPC.loadPaymentScripts(),ProOPC.loadShipmentScripts()}})},ProOPC.loginAjax=function(){var c=a('form#UserLogin'),m=a('button#proopc-task-loginajax',c),u=c.find('input[name="ctask"]:hidden'),_=c.find('#proopc-login-process');return!!ProOPC.validateForm.call(c)&&('login'!=u.val()&&u.val('login'),ProOPC.ajax('login',{data:c.serialize(),beforeSend:function(){_.append(ProOPC.cache.spinner.el),m.attr('disabled',!0)},success:function(h){_.find('.proopc-spinner').remove(),m.removeAttr('disabled');var f=!0;'1'==h||1==h?f=!0:(!h||-1==h.indexOf('</head>'))&&(f=!1),f?(ProOPC.setmsg('success',VPOPC.JText._('PLG_VPONEPAGECHECKOUT_LOGIN_COMPLETED')),ProOPC._triggerEvent(['login.success']),VPOPC._('RELOAD')?ProOPC._reload():ProOPC.processCheckout()):(ProOPC.setmsg('warning',VPOPC.JText._('JLIB_LOGIN_AUTHENTICATE')),ProOPC._triggerEvent(['login.failed']))},errorCallback:function(){_.find('.proopc-spinner').remove(),m.removeAttr('disabled'),ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS'))}}),!1)},ProOPC.updateBTaddress=function(){ProOPC.ajaxManager.addReq({data:a('form#EditBTAddres').serialize()+'&ctask=savebtaddress&'+ProOPC.getToken(),beforeSend:function(){ProOPC.disableSubmit()},success:function(m){ProOPC._triggerEvent(['checkout.bt.updated']);var u=!1;m.vat_error&&m.msg?(ProOPC.setmsg('warning',m.msg),u=!0,ProOPC.updateVATFieldState(!1,m.info)):ProOPC.updateVATFieldState(!0,m.info),ProOPC.getshipmentpaymentcartlist(u)}},'updateBTaddress')},ProOPC.updateSTaddress=function(){ProOPC.ajaxManager.addReq({data:a('form#EditSTAddres').serialize()+'&ctask=savestaddress&'+ProOPC.getToken(),beforeSend:function(){ProOPC.disableSubmit()},success:function(m){ProOPC._triggerEvent(['checkout.st.updated']);var u=!1;m.vat_error&&m.msg?(ProOPC.setmsg('warning',m.msg),u=!0,ProOPC.updateVATFieldState(!1,m.info,'shipto_')):ProOPC.updateVATFieldState(!0,m.info,'shipto_'),ProOPC.getshipmentpaymentcartlist(u),typeof m.userinfo_id!=typeof void 0&&a('input#shipto_virtuemart_userinfo_id').val(m.userinfo_id)}},'updateSTaddress')},ProOPC.selectSTAddress=function(c){ProOPC.ajax('selectstaddress',{data:'ctask=selectstaddress&shipto_virtuemart_userinfo_id='+a(c).val(),beforeSend:function(){ProOPC.addloader('#proopc-st-address'),ProOPC.disableSubmit()},success:function(m){'object'!==a.type(m)&&(console.warn('Invalid data received'),console.log(m)),a('#proopc-st-address').html(m.editst),ProOPC.pluginLoaded('vm2front')?(0<m.stateid?a('input#STStateID').val(m.stateid):a('input#STStateID').val(''),a('#shipto_virtuemart_country_id_field').vm2front('list',{dest:'#shipto_virtuemart_state_id_field',ids:m.stateid,prefiks:'shipto_'})):console.warn('jQuery.vm2front plugin not loaded. Please enable "Using the Script ajax Countries / Regions" option in VirtueMart Configuration.');var u=!1;m.vat_error&&m.msg?(ProOPC.setmsg('warning',m.msg),u=!0,ProOPC.updateVATFieldState(!1,m.info,'shipto_')):ProOPC.updateVATFieldState(!0,m.info,'shipto_'),ProOPC.setStyle(),a('#shipto_virtuemart_state_id_field').trigger('liszt:updated'),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.removeloader('#proopc-st-address'),ProOPC._triggerEvent(['checkout.st.selected']),ProOPC.getshipmentpaymentcartlist(u)}})},ProOPC.setst=function(c){c&&a(c).length&&(ProOPC.disableSubmit(),c.checked?ProOPC.ajax('btasst',{data:'ctask=btasst',beforeSend:function(){a('.proopc-st-address .edit-address').slideUp()},success:function(m){ProOPC._triggerEvent(['checkout.btasst']);var u=!1;m.vat_error&&m.msg?(ProOPC.setmsg('warning',m.msg),u=!0,ProOPC.updateVATFieldState(!1,m.info,'shipto_')):ProOPC.updateVATFieldState(!0,m.info,'shipto_'),ProOPC.getshipmentpaymentcartlist(u)}}):ProOPC.ajax('btasst',{data:'ctask=btnotasst',beforeSend:function(){a('.proopc-st-address .edit-address').slideDown(),ProOPC.inputwidth(),ProOPC.selectwidth()},success:function(){ProOPC._triggerEvent(['checkout.btnotasst']);var m=a('select#proopc-select-st');m.length&&0<m.val()?ProOPC.selectSTAddress(m[0]):ProOPC.updateSTaddress()}}))},ProOPC.getshipmentpaymentcartlist=function(c){c||a('#proopc-system-message').html(''),ProOPC.ajax('getshipmentpaymentcartlist',{beforeSend:function(){ProOPC.addloader('#proopc-pricelist, #proopc-payments, #proopc-shipments'),ProOPC.disableSubmit()},success:function(m){if('object'!==a.type(m))return ProOPC._reload(),!1;if(0==m.pqty)return ProOPC._reload(),!1;if(m.msg&&ProOPC.setmsg(m.msg_type,m.msg),a('#proopc-shipments').html(m.shipments),a('#proopc-payments').html(m.payments),a('#proopc-pricelist').html(m.cartlist),a('#proopc-cart-totalqty').text(m.pqty),0<m.payment_scripts.length&&''!==m.payment_scripts[0])var u=m.payment_scripts;''!==m.payment_script[0]&&a.each(m.payment_script,function(_,h){a.getScript(h,function(){typeof u!='undefined'&&a.each(u,function(y,E){})})}),0<m.shipment_scripts.length&&''!==m.shipment_scripts[0]&&a.each(m.shipment_scripts,function(_,h){a('head').append('<script type="text/javascript">'+h+'</script>')}),ProOPC._triggerEvent(['checkout.updated.shipmentpaymentcartlist']),ProOPC.productdetails(),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader('#proopc-pricelist, #proopc-payments, #proopc-shipments'),ProOPC.enableSubmit(),ProOPC.defaultSP()},errorCallback:function(){ProOPC.removeloader('#proopc-pricelist, #proopc-payments, #proopc-shipments'),ProOPC.enableSubmit()}})},ProOPC.getcartlist=function(c,m){m||a('#proopc-system-message').html(''),ProOPC.ajax('getcartlist',{beforeSend:function(){ProOPC.addloader('#proopc-pricelist'),ProOPC.disableSubmit()},success:function(u){return'object'===a.type(u)?0==u.pqty?(ProOPC._reload(),!1):void(u.msg&&ProOPC.setmsg(u.msg_type,u.msg),a('#proopc-pricelist').html(u.cartlist),a('#proopc-cart-totalqty').text(u.pqty),!ProOPC.hasValue(u.selected_shipment)&&a('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop('checked',!1),!ProOPC.hasValue(u.selected_payment)&&a('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop('checked',!1),ProOPC._triggerEvent(['checkout.updated.cartlist']),ProOPC.productdetails(),ProOPC.setStyle(),ProOPC.removeloader('#proopc-pricelist'),ProOPC.enableSubmit(),'undefined'!=typeof c&&c&&(d.location=c)):(ProOPC._reload(),!1)},errorCallback:function(){ProOPC.removeloader('#proopc-pricelist'),ProOPC.enableSubmit()}})},ProOPC.getcartsummery=function(){ProOPC.ajax('getcartsummery',{beforeSend:function(){ProOPC.addloader('#proopc-pricelist'),ProOPC.disableSubmit()},success:function(c){return'object'===a.type(c)?0==c.pqty?(ProOPC._reload(),!1):void(c.msg&&ProOPC.setmsg(c.msg_type,c.msg),a('#proopc-cart-totalqty').text(c.pqty),a('#proopc-pricelist').html(c.cartsummery),ProOPC._triggerEvent(['checkout.updated.cartlist']),ProOPC.setStyle(),ProOPC.removeloader('#proopc-pricelist'),ProOPC.enableSubmit()):(ProOPC._reload(),!1)},errorCallback:function(){ProOPC.removeloader('#proopc-pricelist'),ProOPC.enableSubmit()}})},ProOPC.getpayments=function(){ProOPC.ajax('getpaymentlist',{beforeSend:function(){ProOPC.addloader('#proopc-payments'),ProOPC.disableSubmit()},success:function(c){if('object'!==a.type(c))return ProOPC._reload(),!1;if(a('#proopc-payments').html(c.payments),0<c.payment_scripts.length&&''!==c.payment_scripts[0])var m=c.payment_scripts;''!==c.payment_script[0]&&a.each(c.payment_script,function(u,_){a.getScript(_,function(){'undefined'!=typeof m&&a.each(m,function(v,y){})})}),ProOPC._triggerEvent(['checkout.updated.paymentlist']),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader('#proopc-payments'),ProOPC.enableSubmit(),ProOPC.defaultSP()},errorCallback:function(){ProOPC.removeloader('#proopc-payments'),ProOPC.enableSubmit()}})},ProOPC.getPaymentData=function(c){c=ProOPC.hasValue(c),a('.klarna_box_bottom').hide(),a('.vmpayment_cardinfo').removeClass('show').addClass('hide');var m=a('form#proopc-payment-form'),u=m.find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');if(!u.length)return!1;var _=u.data('pmtype'),h=u.data('paypalproduct'),f='0',g='0';return h&&(_+=h),_&&a('.vmpayment_cardinfo.'+_).length&&(a('.vmpayment_cardinfo.'+_).removeClass('hide').addClass('show'),g='1'),'sisowideal'==_&&(g='1'),c&&(f='1',g='1'),u.hasClass('klarnaPayment')&&ProOPC.klarnaOpenClose.call(u[0]),ProOPC._triggerEvent(['prepare.data.payment',u[0]]),m.serialize()+'&ajax=1&savecc='+f+'&payment_data='+g},ProOPC.getShipmentData=function(){var c='form#proopc-shipment-form',m=a(c),u=m.find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked');if(!u.length)return!1;var _=u.val(),h=u.data('usps'),f=u.data('ups'),g=u.data('upsrates');return a('#usps_name-'+_,m).length&&h&&a('#usps_name-'+_,m).val(h.service),a('#usps_rate-'+_,m).length&&h&&a('#usps_rate-'+_,m).val(h.rate),a('#ups_rate-'+_,m).length&&f&&a('#ups_rate-'+_,m).val(f.id),a('#upsrates-'+_,m).length&&g&&a('#upsrates-'+_,m).val(g),ProOPC._triggerEvent(['prepare.data.shipment',m[0],u[0]]),a(c).serialize()},ProOPC.loadPaymentScripts=function(){ProOPC.ajax('getpaymentscripts',{beforeSend:function(){ProOPC.addloader('#proopc-payments'),ProOPC.disableSubmit()},success:function(c){'object'===a.type(c)&&(a('#proopc-payments').html(c.payments),c.payment_scripts.length&&''!==c.payment_scripts[0]&&(payment_scripts=c.payment_scripts),c.payment_script.length&&''!==c.payment_script[0]&&a.each(c.payment_script,function(m,u){a.getScript(u,function(){'undefined'!=typeof payment_scripts&&a.each(payment_scripts,function(g,v){})})})),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader('#proopc-payments'),ProOPC.defaultSP(),ProOPC.enableSubmit()},errorCallback:function(){ProOPC.removeloader('#proopc-payments'),ProOPC.enableSubmit()}})},ProOPC.loadShipmentScripts=function(){return!!a('form#proopc-shipment-form select').length&&void ProOPC.ajax('getshipmentscripts',{beforeSend:function(){ProOPC.addloader('#proopc-shipments'),ProOPC.disableSubmit()},success:function(c){'object'===a.type(c)&&(a('#proopc-shipments').html(c.shipments),c.shipment_scripts.length&&c.shipment_scripts[0]&&a.each(c.shipment_scripts,function(m,u){a('head, body').find('script[type="text/javascript"]').each(function(){var _=a(this).attr('src');if('undefined'==typeof _||!1===_)return a(this).append(u),!1})})),ProOPC.setStyle(),ProOPC.tooltip(),ProOPC.removeloader('#proopc-shipments'),ProOPC.defaultSP(),ProOPC.enableSubmit()},errorCallback:function(){ProOPC.removeloader('#proopc-shipments'),ProOPC.enableSubmit()}})},ProOPC.defaultSP=function(){var u,c=a('form#proopc-shipment-form'),m=a('form#proopc-payment-form'),_='input[type="radio"][name="virtuemart_shipmentmethod_id"]',h='input[type="radio"][name="virtuemart_paymentmethod_id"]',f=VPOPC._('AUTOSHIPMENT'),g=VPOPC._('AUTOPAYMENT'),v='';0<=f&&!c.find(_+':checked').length&&c.find(_).length&&(0==f&&(f=c.find(_+':first').val()),u=c.find(_+'[value="'+f+'"]'),0<f&&u.length&&(u.attr('checked',!0),v+=ProOPC.getShipmentData())),0<=g&&!m.find(h+':checked').length&&m.find(h).length&&(0==g&&(g=m.find(h+':first').val()),u=m.find(h+'[value="'+g+'"]'),0<g&&u.length&&'exp'!=u.data('paypalproduct')&&(u.attr('checked',!0),v&&(v+='&'),v+=ProOPC.getPaymentData())),v&&''!=v&&ProOPC.ajax('setdefaultsp',{data:'ctask=setdefaultsp&'+v,beforeSend:function(){ProOPC.addloader('#proopc-shipments, #proopc-payments'),ProOPC.disableSubmit()},success:function(y){ProOPC.hasValue(y.selected_shipment)||a('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop('checked',!1),ProOPC.hasValue(y.selected_payment)||a('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop('checked',!1),ProOPC.enableSubmit(),ProOPC.removeloader('#proopc-shipments, #proopc-payments'),typeof y.error!=typeof void 0&&'undefined'!=typeof y.error&&y.error?ProOPC._triggerEvent(['checkout.defaultsp.failed']):(ProOPC._triggerEvent(['checkout.defaultsp.success']),ProOPC.getcartlist())},errorCallback:function(){a('form#proopc-shipment-form input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked').prop('checked',!1),a('form#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked').prop('checked',!1),ProOPC.enableSubmit(),ProOPC.removeloader('#proopc-shipments, #proopc-payments')}})},ProOPC.setshipment=function(){var m=ProOPC.getShipmentData(),u=a('form#proopc-shipment-form'),_=u.find('input[type="radio"][name="virtuemart_shipmentmethod_id"]:checked'),h=_.val();return!!m&&void ProOPC.ajax('setshipment',{data:'ctask=setshipments&'+m,beforeSend:function(){ProOPC.disableSubmit(),ProOPC.disableMethodSelection()},success:function(f){ProOPC.hasValue(f.selected)||(_.prop('checked',!1),f.selected=0),a('input#proopc-savedShipment:hidden').val(f.selected),f.error?(ProOPC.setmsg('2',f.msg),ProOPC._triggerEvent(['checkout.shipmentselection.failed',h]),ProOPC.getcartlist(!1,!0)):(ProOPC._triggerEvent(['checkout.shipmentselection.success',h]),ProOPC.getcartlist(),VPOPC._('RELOADPAYMENTS')&&ProOPC.getpayments())},errorCallback:function(){_.prop('checked',!1),ProOPC.enableSubmit()}})},ProOPC.setpayment=function(c){var m=ProOPC.hasValue(c)&&a(c).length&&a(c).hasClass('btn-additional-klarna'),_=ProOPC.getPaymentData(m),h=a('form#proopc-payment-form'),f=h.find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked'),g=f.val();return!!_&&void ProOPC.ajax('setpayment',{data:'ctask=setpayment&'+_,async:!m,beforeSend:function(){ProOPC.disableSubmit(),ProOPC.disableMethodSelection()},success:function(v,y,E){if(E&&0<=E.getResponseHeader('content-type').indexOf('text/html')&&'undefined'!=typeof klarna){a('#proopc-order-submit').removeAttr('disabled'),a('<div />',{id:'proopc-temp',style:'display:none'}).appendTo('body'),a('#proopc-temp').append(v);a('#proopc-temp').find('div#system-message-container').html();ProOPC.setmsg(1,r),ProOPC.enableSubmit()}if(('string'===a.type(v)||'string'==typeof v)&&(v=a.parseJSON(v)),v.redirect=v.redirect?v.redirect:0,ProOPC.hasValue(v.selected)||f.prop('checked',!1),v.error)ProOPC.setmsg(2,v.msg),ProOPC._triggerEvent(['checkout.paymentselection.failed',g]),ProOPC.getcartlist(!1,!0);else if(v.redirect)ProOPC.setmsg(4,VPOPC.JText._('VMPAYMENT_PAYPAL_REDIRECT_MESSAGE')),ProOPC._triggerEvent(['checkout.paymentselection.successs',g]),ProOPC.getcartlist(v.redirect,!0);else if(m)ProOPC._triggerEvent(['checkout.paymentmethod.additionaldata.saved',g]),ProOPC.setmsg(4,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED')),ProOPC.enableSubmit();else{var b=!1;v.msg&&(f.hasClass('klarnaPayment')||!ProOPC.hasValue(v.selected))&&(ProOPC.setmsg(2,v.msg),b=!0),ProOPC._triggerEvent(['checkout.paymentselection.successs',g]),ProOPC.getcartlist(!1,b)}},errorCallback:function(){f.prop('checked',!1),ProOPC.enableSubmit()}})},ProOPC.deleteproduct=function(c){return ProOPC.ajax('deleteproduct',{data:'ctask=deleteproduct&id='+a(c).data('vpid'),beforeSend:function(){ProOPC.addloader('#proopc-pricelist, #proopc-payments, #proopc-shipments'),ProOPC.disableSubmit()},success:function(m){return ProOPC._triggerEvent(['checkout.products.deleted',a(c).data('vpid')]),a('#proopc-system-message').html(''),a('.proopc-product-hover').addClass('hide'),0!=m.pqty&&m.pqty?void(0<a('input#proopc-cart-summery').length?ProOPC.getcartsummery():ProOPC.getshipmentpaymentcartlist(),a('body').trigger('updateVirtueMartCartModule')):(ProOPC._reload(),!1)},errorCallback:function(){ProOPC.enableSubmit()}}),!1},ProOPC.updateproductqty=function(){var m=!1;return(a('.proopc-qty-input').each(function(){if(a(this).data('quantity')!=a(this).val())return m=!0,!1}),!!m)&&(ProOPC.ajax('updateProductQty',{data:a('#proopc-carttable-form').serialize(),beforeSend:function(){ProOPC.addloader('#proopc-pricelist, #proopc-payments, #proopc-shipments'),ProOPC.disableSubmit()},success:function(u){return'object'===a.type(u)?(u.error?ProOPC.setmsg(2,u.msg):(ProOPC._triggerEvent(['checkout.products.updated',u.pqty]),a('#proopc-system-message').html('')),a('.proopc-product-hover').addClass('hide'),0!=u.pqty&&u.pqty?void(0<a('input#proopc-cart-summery').length?ProOPC.getcartsummery():ProOPC.getshipmentpaymentcartlist(),a('body').trigger('updateVirtueMartCartModule')):(ProOPC._reload(),!1)):(ProOPC._reload(),!1)},errorCallback:function(){ProOPC.enableSubmit()}}),!1)},ProOPC.savecoupon=function(){var m=a('input#proopc-coupon-code'),u=m.val(),_=m.data('default');return(a('#proopc-system-message').html(''),!u||u==_)?(ProOPC.setmsg(2,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_COUPON_EMPTY')),!1):(ProOPC.ajax('setcoupon',{data:'ctask=setcoupon&coupon_code='+encodeURIComponent(u),beforeSend:function(){ProOPC.addloader('#proopc-coupon'),ProOPC.disableSubmit()},success:function(h){if('object'!==a.type(h))return ProOPC._reload(),!1;ProOPC._triggerEvent(['checkout.coupon.submitted',u,h.msg]);var f=h.error?h.error:'success';m.val(_),!h.wait&&h.msg&&ProOPC.setmsg(f,h.msg),ProOPC.removeloader('#proopc-coupon'),VPOPC._('RELOADALLFORCOUPON')?ProOPC.getshipmentpaymentcartlist(!0):ProOPC.getcartlist(null,!0),a('body').trigger('updateVirtueMartCartModule')},errorCallback:function(){ProOPC.setmsg(1,'An error has occurred while processing coupon code. See console log for more details.'),ProOPC.removeloader('#proopc-coupon'),ProOPC.enableSubmit()}}),!1)},ProOPC.fieldGroups=[['title','first_name'],['middle_name','last_name'],['zip','city'],['shipto_middle_name','shipto_last_name'],['shipto_zip','shipto_city']],ProOPC.inputwidth=function(){if(a('form#EditBTAddres').children().each(function(h){a(this).data('pos',h)}),a('form#EditSTAddres').children().each(function(h){a(this).data('pos',h)}),VPOPC._('GROUPING')&&'array'===a.type(ProOPC.fieldGroups)&&ProOPC.fieldGroups.length){var c,m;a.each(ProOPC.fieldGroups,function(h,f){'array'===a.type(f)&&2==f.length&&(c=a('.'+f[0]+'-group'),m=a('.'+f[1]+'-group'),c.length&&m.length&&c.data('pos')+1==m.data('pos')&&a('.'+f[0]+'-group, .'+f[1]+'-group').wrapAll('<div class="proopc-row group-enabled" />'))})}a('.proopc-bt-address input[type="text"], .proopc-bt-address input[type="email"], .proopc-st-address input[type="text"], .proopc-st-address input[type="email"], .proopc-additional-info input[type="text"], .proopc-confirm-order input[type="text"]').each(function(){a(this).css('width','');var h=a(this).parent('.inner').width();a(this).width(h-15)}),a('.proopc-register-login input[type="text"], .proopc-register-login input[type="password"], .proopc-register-login input[type="email"]').each(function(){a(this).css('width','');var h=a(this).parent('.proopc-input').width();a(this).width(h-27)}),a('.proopc-register-login button').each(function(){a(this).css('width','');var h=a(this).parent('.proopc-input').outerWidth(!0);a(this).width(h)});var u=a('#proopc-coupon .proopc-input-append').width(),_=a('#proopc-coupon').find('button.proopc-btn').outerWidth(!0);a('#proopc-coupon-code').width(u-_-20).css('margin-right',5)},ProOPC.selectwidth=function(){a('.proopc-bt-address select, .proopc-st-address select, .proopc-additional-info select, .proopc-confirm-order select').each(function(){a(this).css('width','');var c=a(this).parent('.inner').width();a(this).outerWidth(c-3)}),a('.proopc-register-login select').each(function(){a(this).css('width','');var c=a(this).parent('.proopc-input').width();a(this).outerWidth(c-27)})},ProOPC.productdetails=function(){return!!a('.proopc-cart-product').length&&(ProOPC.pluginLoaded('hoverIntent')?void a('.proopc-cart-product').each(function(){var c=this,m=a(c).data('details'),m=a('#'+m),u=a('table.proopc-p-info-table',m);a(c).hoverIntent({interval:100,sensitivity:6,timeout:100,over:function(){a(c).addClass('open'),a(u).width(a(c).width()),a(m).show().css('top',a(c).position().top).animate({opacity:1,top:a(c).position().top+a(c).height()},150,'linear')},out:function(){a(c).removeClass('open'),a(m).animate({opacity:0},100,'linear',function(){a(this).hide().css('top',0)})}})}):(console.warn('jQuery.hoverIntent plugin is not loaded. Product mouseover effect is being disabled to avoid errors.'),!1))},ProOPC.tooltip=function(){var c=a.now(),m=a('<div />',{'class':'tooltip-title'}),u=a('<div />',{'class':'tooltip-body'}),_=a('<p />',{'class':'proopc-tooltip'});a('.hover-tootip').each(function(h){var f=a(this).attr('title');f&&(a(this).attr('data-tiptext',f).removeAttr('title'),a(this).data('uniqueid','proopc-tip-'+c+'-key-'+h)),a(this).hover(function(g){g.stopPropagation();var v=a(this).data('uniqueid'),y=a(this).attr('data-tiptext'),E=null,S=null;if(v&&y){if(!a('#'+v).length){if(0<=y.indexOf('::')){var b=y.split('::');E=b[0],S=b[1]}else E=null,S=y;S&&(_.html('').attr('id',v),E&&_.append(m.html(E)),_.append(u.html(S)).appendTo('body'))}a('#'+v).addClass('show')}},function(){var g=a(this).data('uniqueid');g&&a('#'+g).length&&(a('#'+g).removeClass('show'),setTimeout(function(){a('#'+g).remove()},180))}).mousemove(function(g){var v=a(this).data('uniqueid');if(v&&a('#'+v).length){var y=a('#'+v),E=y.outerWidth(),S=y.outerHeight(),b=a(this).outerHeight();y.css({top:g.pageY-(S+b+2),left:g.pageX-E/2})}})})},ProOPC.fieldTip=function(){a('.hasFieldTip').hover(function(){a(this).attr('title')&&ProOPC.showFieldTip(this)},function(){ProOPC.removeFieldTip(this,!0)})},ProOPC.showFieldTip=function(c){var m=a(c),u='field-tip-'+a.now(),_=a(c).attr('title'),h=a(c).outerWidth(),f=a(c).offset();if(!m.data('tip')){m.data('tipText',_).data('tip','#'+u).removeAttr('title');var g=a('<p />',{id:u,'class':'proopc-fieldtip',style:'margin: 0px;'}),v=a('<div />',{'class':'fieldtip-body'}).html(_);g.html(v).css('visibility','hidden').appendTo('body');var y=g.outerWidth(),E=g.outerHeight(),S=f.top-(E+6),b=f.left+(h-y)/2;g.css({top:S,left:b,visibility:''}).fadeIn(200),a(d).resize(function(){var C;C&&clearTimeout(C),C=setTimeout(function(){h=m.outerWidth(),f=m.offset(),y=g.outerWidth(),E=g.outerHeight(),S=f.top-(E+6),b=f.left+(h-y)/2,g.css({top:S,left:b})},200)}),m.is(':hidden')&&ProOPC.removeFieldTip(c,!0),a('input[name="proopc-method"][type="radio"]').change(function(){ProOPC.removeFieldTip(c,!0)})}},ProOPC.removeFieldTip=function(c,m){var u=a(c),_=u.data('tip');_&&a(_).length&&(m&&u.attr('title',u.data('tipText')),u.data('tip',null),a(_).animate({opacity:0},200,function(){a(this).remove()}))},ProOPC.setStyle=function(){var c=0,m='.proopc-register > .proopc-inner, .proopc-login > .proopc-inner';a(m).css('min-height','').each(function(){a(this).outerHeight()>c&&(c=a(this).outerHeight())}),0<c&&a(m).css('min-height',c);var u=a('#ProOPC #dynamic_recaptcha_1 table:visible');if(u.length){var _=u.width(),h=u.closest('.proopc-input'),f=h.siblings('.proopc-input-group-level');h.width(_);var g=a('.proopc-register > .proopc-inner').width()-35;f.width(g-_)}var v,y;if(a('table.cart-summary.proopc-table-striped td').each(function(){v=a(this).text(),v=v?a.trim(v):'',y=a(this).html(),y=y?a.trim(y):'',(v&&v.length||y&&y.length)&&!a(this).is(':empty')||a(this).addClass('cell-empty')}),a('table.cart-summary.proopc-table-striped span.vm-price-desc').each(function(){v=a(this).text(),v=v?a.trim(v):'',y=a(this).html(),y=y?a.trim(y):'',(v&&v.length||y&&y.length)&&!a(this).is(':empty')||a(this).hide()}),a('.proopc-p-price > div, .proopc-taxcomponent > div, .proopc-p-discount > div').each(function(){a(this).is(':visible')&&a(this).css('display','inline')}),a('.proopc-login-message-cont').hover(function(){a('.proopc-logout-cont').removeClass('hide')},function(){a('.proopc-logout-cont').addClass('hide')}),a('.proopc-logout-cont').css('min-width',a('.proopc-loggedin-user').width()),a('[data-vpopc="redirect"]').off('click').on('click',function(P){P.preventDefault();var A=a(this).attr('href'),A=A?A.replace('#',''):null,O=a(this).data('vphref');if(A){var k=a('<input />',{type:'hidden',name:'ctask',value:A});a('<form />',{action:VPOPC._('URI'),method:'post'}).html(k).appendTo('body').submit()}else O&&(d.location.href=O);return!1}),typeof d.bonusCartItemIds!='undefined'&&'undefined'!=typeof d.bonusCartItemIds&&a.each(d.bonusCartItemIds,function(P,A){if(!A.userCanUpdateQuantity){var O=a('input[data-vpid="'+A.cartItemId+'"]').parent('.proopc-input-append'),k=a(O).children('input[name="quantity"]').val();a(O).hasClass('bonusSet')||(O.before(k),a(O).addClass('bonusSet')),O.hide(),O.parent().find('button.remove_from_cart').hide()}}),VPOPC._('STYLERADIOCHEBOX')){var E;a('#UserRegistration input[type="radio"], #EditBTAddres input[type="radio"], #EditSTAddres input[type="radio"]').each(function(){a(this).css({width:'auto',float:'left'}),E=a(this).attr('id'),E&&a('label[for="'+E+'"]').addClass('proopc-radio-label')}),a('#UserRegistration input[type="checkbox"], #EditBTAddres input[type="checkbox"], #EditSTAddres input[type="checkbox"]').each(function(){a(this).css({width:'auto',float:'left',margin:'4px 5px 0 0'}).parent('.proopc-input-append').css('padding-top','4px').siblings('br').remove(),E=a(this).attr('id'),E&&a('label[for="'+E+'"]').css({float:'left','padding-left':'10px','padding-right':'10px'}).insertAfter(this)})}if(a('.proopc-creditcard-info').each(function(){if(!a(this).closest('.vmpayment_cardinfo').length){var P=a(this).prevAll('input[name="virtuemart_paymentmethod_id"]');if(P.length){var A=P.data('pmtype'),O=P.data('paypalproduct'),k=' hide';A&&(O&&(A+=O),P.is(':checked')&&(k=' show'),a(this).wrap('<span class="vmpayment_cardinfo additional-payment-info '+A+k+'" />'))}}}),'undefined'!=typeof klarna&&'undefined'!=typeof klarna&&ProOPC.callKlarna(),a('#sisow_bank').closest('fieldset').length&&a('#sisow_bank').width(a('#sisow_bank').closest('fieldset').width()),a('#monthinstallments').closest('.proopc-row').length&&a('#monthinstallments').width(a('#monthinstallments').closest('.proopc-row').width()),a('.vmpayment_cardinfo').parent().is('div')&&a('.vmpayment_cardinfo').unwrap(),a('#ProOPC select[name="virtuemart_state_id"], #ProOPC select[name="shipto_virtuemart_state_id"]').on('liszt:updated',function(){var V,P=a(this).attr('id'),A=P&&a('select#'+P).length?a('select#'+P)[0]:this,O=a(A).closest('form'),k=a('select[name="virtuemart_country_id"]',O),x=P?a('label[for="'+P+'"]'):null,R=x&&x.length?x.find('.asterisk'):null,I=a(A).find('optgroup'),L=a(A).find('option:first'),L=L.length&&!L.val()?L:null,G=VPOPC.JText._('COM_VIRTUEMART_LIST_EMPTY_OPTION'),N=a('input#STStateID').val();if(L)if(!L.data('selectText')){var G=L.text();L.data('selectText',G)}else var G=L.data('selectText');k.length||(k=a('select[name="shipto_virtuemart_country_id"]',O)),V=k.val(),0<V&&I.each(function(){a(this).data('forcountry')&&a(this).data('forcountry')!=V?a(this).remove():a('option',this).length?a(this).data('forcountry',V):a(this).remove()}),a(A).removeClass('required'),I&&I.length?(a(A).removeAttr('readonly'),a(A).data('frequired')&&(a(A).attr('required',!0),R&&R.show()),L&&L.text(G),'shipto_virtuemart_state_id'==P&&0<N&&!a(A).val()&&I.find('option[value="'+N+'"]').length&&(I.find('option[value="'+N+'"]').attr('selected',!0),a(A).val(N))):(a(A).removeAttr('required').attr('readonly',!0),R&&R.hide(),L&&L.text(VPOPC.JText._('COM_VIRTUEMART_NONE'))),a(A).trigger('opcvalidate')}),VPOPC._('REMOVEUNNECESSARYLINKS')&&VPOPC._('EDITPAYMENTURI')&&(a('span.vmpayment a').each(function(){var P=a(this).closest('label').siblings('.vmpayment_cardinfo');if(P.length){a('<div />',{'class':'proopc-payment-text'}).text(a(this).text()).prependTo(P);a(this).remove()}}),a('#ProOPC a').each(function(){a(this).attr('href')==VPOPC._('EDITPAYMENTURI')&&a(this).remove()})),VPOPC._('TOSFANCY')){if(!ProOPC.pluginLoaded('fancybox'))return console.warn('jQuery.fancybox plugin is not loaded. Terms of Service may not display properly.'),!1;var S=a('div#proopc-tos-fancy'),h=S.parent(),b=a.easing&&a.easing.hasOwnProperty('elastic')?'elastic':'fade';a('[data-tos="fancybox"]').fancybox({titlePosition:'inside',padding:0,showCloseButton:!1,centerOnScroll:!0,transitionIn:'fade',transitionOut:b,overlayOpacity:0.8,overlayColor:'#000',onClosed:function(){a(this.href).length||(h.html(S),a('div#proopc-tos-fancy button.fancy-close').click(function(P){P.preventDefault(),a.fancybox.close()}))}}),a('div#proopc-tos-fancy button.fancy-close').click(function(P){P.preventDefault(),a.fancybox.close()})}VPOPC._('RELOAD')&&!a('#ProOPC').hasClass('loaded')&&a('.proopc-reload').length&&a('html,body').animate({scrollTop:a('#proopc-system-message').offset().top-100},500,function(){a('#ProOPC').addClass('loaded')});var C=a('input.klarnaPayment[type="radio"]'),T=a('form#proopc-payment-form').find('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');C.length&&(C.attr('onclick','return ProOPC.setpayment(this);').closest('table').addClass('proopc-klarna-payment'),T.length&&ProOPC.klarnaOpenClose.call(T[0])),a('.checkout-advertise .pp-credit a, .checkout-advertise .pp-express a').removeAttr('target')},ProOPC.isMobile=function(){var c=navigator.userAgent.toLowerCase(),m='PC';return(c.match(/android/i)?m='Android':c.match(/blackberry/i)?m='BlackBerry':c.match(/iphone/i)?m='iPhone':c.match(/ipad/i)?m='iPad':c.match(/ipod/i)?m='iPod':c.match(/opera mini/i)?m='Opera Mini':c.match(/iemobile/i)?m='IEMobile':c.match(/fban|fbav/i)&&(m='Facebook'),'PC'==m)?(a('html').addClass('device-is-pc').removeClass('device-is-handheld'),!1):(a('html').addClass('device-is-handheld').removeClass('device-is-pc'),m)},ProOPC.klarnaOpenClose=function(){if(!a(this).hasClass('klarnaPayment'))return!1;var m=this,u=a(m).closest('proopc-klarna-payment'),_=a('.klarna_box_bottom_right .klarna_box_bottom_content .btn-additional-klarna',u),h=0;u.siblings().find('.klarna_box_bottom:visible').hide(),a('.proopc-klarna-payment input[name="klarna_paymentmethod"]').attr('disabled',!0),a('input[name="klarna_paymentmethod"]',u).removeAttr('disabled'),a('.klarna_box_bottom:hidden',u).css('opacity',0).show(),a('input[type="text"]',u).width('auto'),a('input[type="text"]:visible').each(function(){h=a(this).parent('div').width(),h&&a(this).css('max-width',h-13)}),a('.proopc-klarna-payment .klarna_box_bottom_input_combo').each(function(){a(this).children('div').width('100%')}),_.length||(_=a('<button />',{type:'button',class:'proopc-btn btn-additional-klarna',onclick:'return ProOPC.setpayment(this);',style:'margin-top: 15px;'}).text(VPOPC.JText._('COM_VIRTUEMART_SAVE')),a('.klarna_box_bottom_right .klarna_box_bottom_content',u).append(_)),a('div.klarna_box_bottom_title:visible, div.klarna_box_bottom_title:visible',u).removeAttr('style'),a('#box_klarna_consent_invoice:visible',u).parent('div').addClass('proopc-klarna-consent-container').width('auto'),a('#box_klarna_consent_part:visible',u).parent('div').addClass('proopc-klarna-consent-container').width('auto'),a('.klarna_box_bottom:visible',u).animate({opacity:1},300)},ProOPC.callKlarna=function(){var c=a('body'),m=a('#klarna_baloon').clone(),u=a('#klarna_blue_baloon').clone();if(a('.klarna_baloon, .klarna_blue_baloon',c).remove(),'undefined'!=typeof klarna&&'undefined'!=typeof klarna){if('undefined'!==klarna.doDocumentIsReady&&'function'===a.type(klarna.doDocumentIsReady)&&klarna.doDocumentIsReady(a('.klarna_box')),!klarna.unary_checkout){var _=a('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');klarna.gChoice='',_.hasClass('klarnaPayment')&&(klarna.stype=_.data('stype'),klarna.gChoice=_.attr('id')),_.length&&ProOPC.klarnaOpenClose.call(_[0])}klarna.baloons_moved=!0}},ProOPC.getKlarnaForm=function(){var c=a('#proopc-payment-form input[type="radio"][name="virtuemart_paymentmethod_id"]:checked');if(!c.hasClass('klarnaPayment'))return!1;var h,m=c.closest('table'),u=m.find('*').serializeArray(),_=a('<form />');return u.push({name:'task',value:'setpayment'}).push({name:'view',value:'cart'}).push({name:'klarna_paymentmethod',value:selectedPayment.next('input').val()}),a.each(u,function(f,g){h=a('<input />',{type:'hidden',name:g.name,value:g.value}),_.append(h)}),_},ProOPC.setPreloaderState=function(c){var m=a('#proopc-preloader');'init'==c?a(m).addClass('proopc-started'):(setTimeout(function(){a(m).addClass('proopc-loaded').removeClass('proopc-started')},100),setTimeout(function(){a(m).remove()},600))},ProOPC.canCheckout=function(){if(!a('#ProOPC').length)return!1;var c=a('#ProOPC')[0];a(c).hasClass('emptyCart-view')?ProOPC.setPreloaderState('done'):(ProOPC._canCheckoutTask.call(c,!0),setInterval(function(){ProOPC._canCheckoutTask.call(c,!1)},9e5))},ProOPC._canCheckoutTask=function(c){var m=this;ProOPC.ajax('cancheckout',{beforeSend:function(){c&&ProOPC.setPreloaderState('init')},success:function(u){return'object'===a.type(u)?void(c&&ProOPC.setPreloaderState('done'),u.error?(a(m).removeClass('canCheckout'),u.reload&&ProOPC._reload()):a(m).addClass('canCheckout')):(a(m).removeClass('canCheckout'),d.location.reload(!0),!1)},errorCallback:function(){c&&ProOPC.setPreloaderState('done')}})},ProOPC.validateAllForms=function(){var c=a('form#EditBTAddres'),m=a('form#EditSTAddres'),u=a('#proopc-shipments'),_=a('#proopc-payments'),h=a('form#proopc-payment-form'),f=a('form#cartFormFields'),f=f&&f.length?f:a('form#checkoutForm'),g=f.find('input[name="tos"][type="checkbox"]'),v=a('#proopc-entry-single'),y=a('input#STsameAsBT[type="checkbox"]').length&&a('input#STsameAsBT[type="checkbox"]').is(':checked');if(v.length){var E=a('input[name="proopc-method"][type="radio"]',v),S=a('input[name="proopc-method"][value="guest"][type="radio"]',v);if(!E.length)return ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_LOGIN_NEEDED')),!1;if(S.length)S.attr('checked',!0).trigger('change');else return ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_ONLY_REGISTERED_USER_CAN_CHECKOUT')),!1}var b=VPOPC._('EU_VAT_FIELD');if(b&&'string'===a.type(b)&&a('input#'+b+'_field').length&&a('input#'+b+'_field').hasClass('invalid'))return ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_EU_VAT_INVALID')),!1;var C=a('#ProOPC input#STsameAsBT[type="checkbox"]');if(C.length&&!C.is(':checked')){var T='shipto_'+b;if(T&&'string'===a.type(T)&&a('input#'+T+'_field').length&&a('input#'+T+'_field').hasClass('invalid'))return ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_EU_VAT_INVALID')),!1}if(!ProOPC._validateAddressForms.call(c))return ProOPC.setmsg(1,VPOPC.JText._('COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS')),!1;if(!y&&!ProOPC._validateAddressForms.call(m))return ProOPC.setmsg(1,VPOPC.JText._('COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS')),!1;if(u.length&&!a('input[name="virtuemart_shipmentmethod_id"][type="radio"]',u).is(':checked'))return ProOPC.setmsg(1,VPOPC.JText._('COM_VIRTUEMART_CART_NO_SHIPMENT_SELECTED')),!1;if(_.length&&!a('input[name="virtuemart_paymentmethod_id"][type="radio"]',_).is(':checked')&&0>=a('input#vpopc_pp_express_selected').val())return ProOPC.setmsg(1,VPOPC.JText._('COM_VIRTUEMART_CART_NO_PAYMENT_SELECTED')),!1;var P=a('input[type="radio"][name="virtuemart_paymentmethod_id"]:checked',h);if(P.length&&P.hasClass('klarnaPayment')){var x,A=P.closest('table'),O=!1,k=[];a('input, select, textarea, .klarna_box_bottom_title',A).removeClass('invalid'),a('input:visible',A).not(':checkbox').each(function(){a(this).val()||(a(this).addClass('invalid').prev('.klarna_box_bottom_title').addClass('invalid'),x=a(this).prev('.klarna_box_bottom_title').text(),x&&k.push(x),O=!0)});var R=!1;if(a('select',A).each(function(){var L=a(this).val();(!L||''==parseInt(L)||0==parseInt(L)||isNaN(parseInt(L)))&&(a(this).addClass('invalid'),a(this).closest('.klarna_box_bottom_input_combo').prev('.klarna_box_bottom_title').addClass('invalid'),x=a(this).closest('.klarna_box_bottom_input_combo').prev('.klarna_box_bottom_title').text(),x&&!R&&(k.push(x),R=!0),O=!0)}),a('input[type="checkbox"]',A).each(function(){a(this).is(':checked')||(a(this).addClass('invalid').next('.klarna_box_bottom_title').addClass('invalid'),k.push('Klarna: '+VPOPC.JText._('COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS')),O=!0)}),a('input, select, textarea',A).change(function(){a(this).is('input')&&''!=a(this).val()&&a(this).removeClass('invalid').prev('.klarna_box_bottom_title').removeClass('invalid'),a(this).is('select')&&(''!=a(this).val()||'0'!=a(this).val())&&a(this).removeClass('invalid').closest('.klarna_box_bottom_input_combo').prev('.klarna_box_bottom_title').removeClass('invalid'),a(this).is('input[type="checkbox"], input[type="radio"]')&&a(this).is(':checked')&&a(this).removeClass('invalid').next('.klarna_box_bottom_title').removeClass('invalid')}),O&&k.length)return ProOPC.setmsg(1,VPOPC.JText._('COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS')+': '+k.join(', ')+'.'),!1}if(g.length&&g.attr('required')&&!g.is(':checked')){var I=g.data('label'),I=I?I:VPOPC.JText._('COM_VIRTUEMART_CART_PLEASE_ACCEPT_TOS');return ProOPC.setmsg(1,I),!1}return!!ProOPC._validateAddressForms.call(f)||(ProOPC.setmsg(1,VPOPC.JText._('COM_VIRTUEMART_USER_FORM_MISSING_REQUIRED_JS')),!1)},ProOPC._validateAddressForms=function(){return a('input, select, textarea',this).each(function(){a(this).attr('id');a(this).off('opcvalidate').on('change opcvalidate',function(){if(a(this).attr('required')||a(this).hasClass('required')){a(this).attr('required',!0);var m=a(this).val(),u=a(this).attr('name'),_=a(this).closest('form');if(m?ProOPC._updateAddressFieldState.call(this,!0):ProOPC._updateAddressFieldState.call(this,!1),m&&m.length&&('email'==u||'shipto_email'==u||'verify_email'==u)&&(m=a.trim(m),a(this).val(m),('email'==u||'shipto_email'==u)&&(ProOPC.validateEmail(m)?_.find('input[name="verify_email"]').trigger('change'):ProOPC._updateAddressFieldState.call(this,!1)),'verify_email'==u)){var h=_.find('input[name="email"]').val();h&&m!=h&&ProOPC._updateAddressFieldState.call(this,!1)}}else ProOPC._updateAddressFieldState.call(this,!0)})}).trigger('opcvalidate'),a(this).find('input.invalid').length||a(this).find('select.invalid').length||a(this).find('textarea.invalid').length?!1:!0},ProOPC._updateAddressFieldState=function(c){var m=a(this).attr('id'),u=a(this).closest('form'),c=ProOPC.hasValue(c);c?(a(this).removeClass('invalid'),m&&a('label[for="'+m+'"]',u).length&&a('label[for="'+m+'"]',u).removeClass('invalid')):(a(this).addClass('invalid'),m&&a('label[for="'+m+'"]',u).length&&a('label[for="'+m+'"]',u).addClass('invalid'))},ProOPC.close=function(c){a(c).parent('.proopc-alert').remove()},ProOPC.checkForError=function(c){if(!(c&&'object'===a.type(c))){var u=this.hasOwnProperty('error')?this.error:null;ProOPC.ajaxManager.setContinuous(!1),u&&'function'===a.type(u)&&u.call(this)}else if(typeof c.error!='undefined'&&c.error){ProOPC.getcartlist(),ProOPC.removePageLoader(),ProOPC.enableSubmit();var m=VPOPC.JText._('PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS');typeof c.msg!='undefined'&&c.msg&&(m=c.msg),ProOPC.ajaxManager.setContinuous(!1),ProOPC.setmsg(1,m)}else return!0;return!1},ProOPC.updateVATFieldState=function(c,m,u){var _=VPOPC._('EU_VAT_FIELD');u&&_&&(_=u+_),_&&'string'===a.type(_)&&a('input#'+_+'_field').length&&(c?(a('input#'+_+'_field, label[for="'+_+'_field"]').removeClass('invalid'),'object'===a.type(m)&&m.hasOwnProperty(_)&&a('input#'+_+'_field').val(m[_])):a('input#'+_+'_field, label[for="'+_+'_field"]').addClass('invalid'))},ProOPC.commonError=function(){ProOPC.removePageLoader(),ProOPC.enableSubmit(),ProOPC.setmsg(1,VPOPC.JText._('PLG_VPONEPAGECHECKOUT_SYSTEM_ERROR_JS'))},ProOPC.submitOrder=function(c,m){if(m=ProOPC.hasValue(m),!m||1==m){if(a('#proopc-system-message').html(''),!ProOPC.validateAllForms())return!1;ProOPC.ajaxManager.setContinuous(!0),ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS'),ProOPC.disableSubmit();var u=a('#ProOPC input#STsameAsBT[type="checkbox"]'),_=0;(!u.length||u.is(':checked'))&&(_=1),ProOPC.ajaxManager.addReq({data:'ctask=savebtaddress&stage=final&STsameAsBT='+_+'&'+a('form#EditBTAddres').serialize()+'&'+ProOPC.getToken(),beforeSend:function(){ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_SAVING_BILLING_ADDRESS'),ProOPC.disableSubmit()},success:function(v){return!!ProOPC.checkForError.call(this,v)&&void(ProOPC._triggerEvent('checkout.bt.saved'),ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_BILLING_ADDRESS_SAVED'),ProOPC.submitOrder(c,2))},error:ProOPC.commonError},'savebtaddress')}if(2==m){var u=a('#ProOPC input#STsameAsBT[type="checkbox"]'),_=a('#proopc-hidden-confirm input[name="STsameAsBT"]:hidden'),h=a('#proopc-hidden-confirm input[name="shipto"]:hidden');if(!u.length||u.is(':checked'))return a(_).val(1),a(h).val(-1),ProOPC.submitOrder(c,3),!1;a(_).val(0),a(h).val(0),ProOPC.ajaxManager.addReq({data:'ctask=savestaddress&stage=final&'+a('form#EditSTAddres').serialize()+'&'+ProOPC.getToken(),beforeSend:function(){ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_SAVING_SHIPPING_ADDRESS'),ProOPC.disableSubmit()},success:function(v){return!!ProOPC.checkForError.call(this,v)&&void(a(h).val(v.userinfo_id),ProOPC._triggerEvent('checkout.st.saved'),ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_SHIPPING_ADDRESS_SAVED'),ProOPC.submitOrder(c,3))},error:ProOPC.commonError},'savestaddress')}if(3==m&&(0<a('input#vpopc_pp_express_selected').val()?ProOPC.submitOrder(c,4):ProOPC.ajaxManager.addReq({data:'ctask=setpayment&ajax=1&savecc=1&finalise=1&'+a('form#proopc-payment-form').serialize()+'&'+ProOPC.getToken(),beforeSend:function(){ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_SAVING_CREDIT_CARD'),ProOPC.disableSubmit()},success:function(v,y,E){if(0<=E.getResponseHeader('content-type').indexOf('text/html')&&'undefined'!=typeof klarna){ProOPC.removePageLoader(),a('#proopc-order-process').remove(),a('<div />',{id:'proopc-temp',style:'display:none'}).appendTo('body'),a('#proopc-temp').append(v);var S=a('#proopc-temp').find('div#system-message-container').html();return ProOPC.setmsg(1,S),ProOPC.enableSubmit(),!1}return('string'==typeof v&&(v=a.parseJSON(v)),!!ProOPC.checkForError.call(this,v))&&void(!1==v.redirect?(ProOPC._triggerEvent('checkout.paymentmethod.saved'),ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_CREDIT_CARD_SAVED'),ProOPC.submitOrder(c,4)):d.location=v.redirect)},error:ProOPC.commonError},'setpayment')),4==m){var f=a('form#checkoutForm').serialize();a('form#cartFormFields').length&&(f+='&'+a('form#cartFormFields').serialize()),ProOPC.ajaxManager.addReq({data:'ctask=savecartfields&'+f,beforeSend:function(){ProOPC.disableSubmit()},success:function(v){return!!ProOPC.checkForError.call(this,v)&&void(ProOPC._triggerEvent('checkout.cartfields.saved'),ProOPC.submitOrder(c,5))},error:ProOPC.commonError},'savecartfields')}if(5==m&&ProOPC.ajaxManager.addReq({data:'ctask=verifycheckout',beforeSend:function(){ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_VERIFYING_ORDER'),ProOPC.disableSubmit()},success:function(v){return ProOPC.checkForError.call(this,v)?void(ProOPC._triggerEvent('checkout.orderVerification.success'),ProOPC.submitOrder(c,6)):(ProOPC._triggerEvent('checkout.orderVerification.failed'),!1)},error:ProOPC.commonError},'verifycheckout'),6==m||'confirm'==m){ProOPC.addPageLoader('PLG_VPONEPAGECHECKOUT_PLACING_ORDER');var g=a('form#checkoutForm');a(g).append(a('#proopc-hidden-confirm').html()),setTimeout(function(){a(g).submit()},100)}return!1},a(function(){ProOPC.isMobile(),ProOPC.init(!0),ProOPC.initSpinner(),ProOPC.ajaxManager.run(),ProOPC.canCheckout(),ProOPC.setStyle(),ProOPC.inputwidth(),ProOPC.selectwidth(),ProOPC.bindFormValidator(),ProOPC.productdetails(),ProOPC.tooltip(),ProOPC.fieldTip(),ProOPC.defaultSP(),a(d).on('proopc:saferesize',function(){ProOPC.setStyle(),ProOPC.inputwidth(),ProOPC.selectwidth()}),a(p).ajaxStop(function(){ProOPC.init(),ProOPC.enableMethodSelection()}),a(p).ajaxError(function(){ProOPC.enableMethodSelection()}),a(d).load(function(){ProOPC.setStyle()})}),d.addEventListener('orientationchange',function(){a(d).trigger('proopc:checkorientation')},!1),a(d).on('resize proopc:checkorientation',function(c){(c.type&&'proopc:checkorientation'===c.type||!ProOPC.isMobile())&&(ProOPC.cache.resizeTimeout&&clearTimeout(ProOPC.cache.resizeTimeout),ProOPC.cache.resizeTimeout=setTimeout(function(){a(d).trigger('proopc:saferesize',[c])},100))})}(ProOPC.jQuery,window,document);